@startuml AdoptAR

skinparam Linetype ortho

package Jwt {

    class AllControllers{

    }

    interface JwtPayload {
        sub: number
        username: string;
        rol_id: number;
    }

    interface AuthenticatedRequest {
        user: JwtPayload;
    }
}

package Acceso_Service{

    class AllServices {

    }

    class AccesoService{

    verificarAcceso(usuarioAuth: JwtPayload, recurso: {{usuario_id: number;}): void    

    verificarUsuarioDeRutaverificarUsuarioDeRuta(usuario: JwtPayload, usuarioIdRuta: number): void

    }

}

package Guards {
    class AuthGuard <<Guard>> {

        canActivate(context: ExecutionContext): Promise<boolean>

        extractTokenFromHeader(request: Request): string | undefined
    }

    class RolesGuard <<Guard>> {

        canActivate(context: ExecutionContext): boolean
    }
}

package Auth {

    class AuthService <<Service>> {
        validateUser(email: string, pass: string): Promise<User>

        signIn(email: string, pass: string): Promise<{access_token: string}>

    }

    class AuthController <<Controller>> {

        signIn(loginDto: LoginDto): Promise<{access_token: string}>

        getProfile(req: AuthRequest): User
    }

    class LoginDto <<DTO>> {
    email: string
    contrasenia: string
    }
}





/' Relaciones '/
AuthController ..> AuthService 
AuthService ..> LoginDto
AuthService ..> UsersService

AuthenticatedRequest ..> JwtPayload

AllServices ..> AccesoService
AllControllers ..> AuthenticatedRequest
AccesoService ..> JwtPayload

RolesGuard ..> AuthGuard
@enduml